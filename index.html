<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Price Map | US Housing Values 2000-2025</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Application CSS -->
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
    <div id="map"></div>

    <!-- Control Panel -->
    <div class="control-panel" id="controlPanel">
        <div class="panel-header">
            <div class="panel-header-text">
                <h1 class="panel-title">üè† Home Price Explorer</h1>
                <p class="panel-subtitle">US Housing Values by ZIP Code</p>
            </div>
            <button class="mobile-toggle" id="mobileToggle" aria-label="Toggle panel">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 15l-6-6-6 6"/>
                </svg>
            </button>
        </div>

        <div class="panel-content" id="panelContent">
            <div class="control-group">
                <label class="control-label">Search ZIP Code</label>
                <div class="search-container">
                    <input type="text" id="zipSearch" class="zip-search" placeholder="Enter 5-digit ZIP..." maxlength="5" inputmode="numeric">
                    <button id="searchBtn" class="search-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </div>
                <div id="searchError" class="search-error"></div>
            </div>

            <div class="control-group">
                <label class="control-label">Select State</label>
                <select id="stateSelect" class="state-select">
                    <option value="">Choose a state...</option>
                </select>
            </div>

            <div class="control-group affordability-group">
                <label class="control-label">
                    <span>Affordability Filter</span>
                    <span class="info-tooltip">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4"/>
                            <path d="M12 8h.01"/>
                        </svg>
                        <span class="tooltip-content">
                            <strong>How this works</strong><br>
                            Uses the standard mortgage qualification rule: your home price should not exceed <strong>3.5√ó your annual income</strong>.<br><br>
                            This is based on the 28% debt-to-income ratio commonly used by lenders, assuming typical mortgage rates, taxes, and insurance.<br><br>
                            <em>Example: $100K income ‚Üí ~$350K max home price</em>
                        </span>
                    </span>
                    <span class="optional-tag">Optional</span>
                </label>
                <div class="affordability-input-row">
                    <span class="income-prefix">$</span>
                    <input type="text" id="incomeInput" class="income-input" placeholder="Annual income" inputmode="numeric">
                    <button id="affordabilityToggle" class="affordability-toggle" title="Toggle affordability view">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </button>
                </div>
                <div class="affordability-info" id="affordabilityInfo"></div>
            </div>

            <div class="control-group">
                <label class="control-label">Year</label>
                <div class="year-display">
                    <span id="currentYear" class="current-year">2000</span>
                    <span class="year-range">2000 - 2025</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="yearSlider" class="year-slider" min="2000" max="2025" value="2000">
                </div>
                <div class="play-controls">
                    <button id="playBtn" class="play-btn">
                        <svg id="playIcon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <span id="playText">Play Timeline</span>
                    </button>
                </div>

                <div class="scale-toggle-container">
                    <div class="scale-toggle">
                        <span class="scale-toggle-label">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 3v18h18"/>
                                <path d="M7 16l4-8 4 4 6-6"/>
                            </svg>
                            Color Scale
                            <span class="info-tooltip scale-tooltip">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 16v-4"/>
                                    <path d="M12 8h.01"/>
                                </svg>
                                <span class="tooltip-content">
                                    <strong>State Scale</strong><br>
                                    Colors are based on the price range within the selected state. Best for seeing variations within a single state.<br><br>
                                    <strong>National Scale</strong><br>
                                    Colors use the same scale across all states, based on national price distribution. Best for comparing states to each other.
                                </span>
                            </span>
                        </span>
                        <div class="toggle-switch">
                            <button class="toggle-option active" id="scaleState" data-scale="state">State</button>
                            <button class="toggle-option" id="scaleNational" data-scale="national">National</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stats-bar" id="statsBar" style="display: none;">
                <div class="stat-item">
                    <div class="stat-value" id="statMedian">-</div>
                    <div class="stat-label">Median</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statMin">-</div>
                    <div class="stat-label">Lowest</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statMax">-</div>
                    <div class="stat-label">Highest</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Panel (shown on hover) -->
    <div class="info-panel" id="infoPanel">
        <div class="info-zip" id="infoZip">ZIP Code</div>
        <div class="info-price" id="infoPrice">$0</div>
        <div class="info-change positive" id="infoChange">+0% since 2000</div>
    </div>

    <!-- Legend -->
    <div class="legend">
        <div class="legend-title">Median Home Value</div>
        <div class="legend-scale" id="legendScale"></div>
        <div class="legend-labels">
            <span id="legendMin">$0</span>
            <span id="legendMax">$1M+</span>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <!-- Welcome Modal -->
    <div class="welcome-modal" id="welcomeModal">
        <div class="welcome-content">
            <div class="welcome-header">
                <span class="welcome-icon">üè†</span>
                <h2>Welcome to the Home Price Explorer</h2>
            </div>
            <div class="welcome-body">
                <div class="welcome-section">
                    <h3>üìä About the Data</h3>
                    <p>This map displays the <strong>Zillow Home Value Index (ZHVI)</strong> ‚Äî Zillow's smoothed, seasonally adjusted measure of typical home values across the United States.</p>
                </div>
                <div class="welcome-section">
                    <h3>üè° Single-Family Homes Only</h3>
                    <p>Data shown is for <strong>single-family residences (SFH)</strong> only. Condos, co-ops, and multi-family properties are excluded to provide a cleaner comparison across regions.</p>
                </div>
                <div class="welcome-section">
                    <h3>üìÖ Time Range</h3>
                    <p>Explore median home values from <strong>2000 to 2025</strong> using the year slider. Watch how housing markets evolved over 25 years.</p>
                </div>
                <p class="welcome-source">Data source: <a href="https://www.zillow.com/research/data/" target="_blank" rel="noopener">Zillow Research</a></p>
            </div>
            <button class="welcome-close" id="welcomeClose">Get Started</button>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
